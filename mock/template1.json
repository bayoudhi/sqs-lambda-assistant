{
  "Resources": {
    "SQSQueue1": {
      "Type": "AWS::SQS::Queue"
    },
    "SQSQueue2": {
      "Type": "AWS::SQS::Queue"
    },
    "LambdaFunction1": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Handler": "index.handler",
        "Role": "arn:aws:iam::123456789012:role/lambda-role",
        "FunctionName": "LambdaFunction1",
        "Runtime": "nodejs14.x",
        "Code": {
          "S3Bucket": "lambda-code-bucket",
          "S3Key": "lambda-code1.zip"
        },
        "Environment": {
          "Variables": {
            "QUEUE_URL": { "Ref": "SQSQueue1" }
          }
        }
      }
    },
    "LambdaFunction2": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Handler": "index.handler",
        "Role": "arn:aws:iam::123456789012:role/lambda-role",
        "FunctionName": "LambdaFunction2",
        "Runtime": "nodejs14.x",
        "Code": {
          "S3Bucket": "lambda-code-bucket",
          "S3Key": "lambda-code2.zip"
        },
        "Environment": {
          "Variables": {
            "QUEUE_URL": { "Ref": "SQSQueue2" }
          }
        }
      }
    },
    "EventSourceMapping1": {
      "Type": "AWS::Lambda::EventSourceMapping",
      "Properties": {
        "BatchSize": 5,
        "EventSourceArn": { "Fn::GetAtt": ["SQSQueue1", "Arn"] },
        "FunctionName": { "Ref": "LambdaFunction1" }
      }
    },
    "EventSourceMapping2": {
      "Type": "AWS::Lambda::EventSourceMapping",
      "Properties": {
        "BatchSize": 5,
        "EventSourceArn": { "Fn::GetAtt": ["SQSQueue2", "Arn"] },
        "FunctionName": { "Ref": "LambdaFunction2" }
      }
    },
    "S3Bucket": {
      "Type": "AWS::S3::Bucket"
    },
    "LambdaFunctionS3": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Handler": "index.handler",
        "Role": "arn:aws:iam::123456789012:role/lambda-role",
        "FunctionName": "LambdaFunctionS3",
        "Runtime": "nodejs14.x",
        "Code": {
          "S3Bucket": "lambda-code-bucket",
          "S3Key": "lambda-code-s3.zip"
        },
        "Environment": {
          "Variables": {
            "BUCKET_NAME": { "Ref": "S3Bucket" }
          }
        }
      }
    },
    "DynamoDBTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          { "AttributeName": "UserId", "AttributeType": "N" }
        ],
        "KeySchema": [{ "AttributeName": "UserId", "KeyType": "HASH" }],
        "ProvisionedThroughput": {
          "ReadCapacityUnits": 5,
          "WriteCapacityUnits": 5
        }
      }
    },
    "LambdaFunctionDynamoDB": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Handler": "index.handler",
        "Role": "arn:aws:iam::123456789012:role/lambda-role",
        "FunctionName": "LambdaFunctionDynamoDB",
        "Runtime": "nodejs14.x",
        "Code": {
          "S3Bucket": "lambda-code-bucket",
          "S3Key": "lambda-code-dynamodb.zip"
        },
        "Environment": {
          "Variables": {
            "TABLE_NAME": { "Ref": "DynamoDBTable" }
          }
        }
      }
    }
  }
}
